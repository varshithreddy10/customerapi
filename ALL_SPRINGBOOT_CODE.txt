================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\Dockerfile ================
FROM eclipse-temurin:17-jdk

WORKDIR /app

COPY target/*.jar app.jar

EXPOSE 7003

ENTRYPOINT ["java","-jar","app.jar"]

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\pom.xml ================
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>4.0.1</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.ecom</groupId>
	<artifactId>customerapi</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>customerapi</name>
	<description>Demo project for Spring Boot</description>
	<url/>
	<licenses>
		<license/>
	</licenses>
	<developers>
		<developer/>
	</developers>
	<scm>
		<connection/>
		<developerConnection/>
		<tag/>
		<url/>
	</scm>
	<properties>
		<java.version>17</java.version>
		<spring-cloud.version>2025.1.0</spring-cloud.version>
	</properties>
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>


		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-devtools</artifactId>
			<scope>runtime</scope>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>com.mysql</groupId>
			<artifactId>mysql-connector-j</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.projectlombok</groupId>
			<artifactId>lombok</artifactId>
			<optional>true</optional>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa-test</artifactId>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-actuator</artifactId>
		</dependency>

		<dependency>
			<groupId>org.modelmapper</groupId>
			<artifactId>modelmapper</artifactId>
			<version>3.2.2</version>
		</dependency>

		<dependency>
			<groupId>org.springdoc</groupId>
			<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
			<version>2.8.13</version>
		</dependency>

		<dependency>
			<groupId>com.mysql</groupId>
			<artifactId>mysql-connector-j</artifactId>
			<scope>runtime</scope>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>


		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-security-test</artifactId>
			<scope>test</scope>
		</dependency>


		<!-- JWT -->
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt-api</artifactId>
			<version>0.12.6</version>
		</dependency>
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt-impl</artifactId>
			<version>0.12.6</version>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>io.jsonwebtoken</groupId>
			<artifactId>jjwt-jackson</artifactId>
			<version>0.12.6</version>
			<scope>runtime</scope>
		</dependency>


		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-openfeign</artifactId>
		</dependency>

	</dependencies>


	<dependencyManagement>
		<dependencies>
			<dependency>
				<groupId>org.springframework.cloud</groupId>
				<artifactId>spring-cloud-dependencies</artifactId>
				<version>${spring-cloud.version}</version>
				<type>pom</type>
				<scope>import</scope>
			</dependency>
		</dependencies>
	</dependencyManagement>

	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<annotationProcessorPaths>
						<path>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</path>
					</annotationProcessorPaths>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<configuration>
					<excludes>
						<exclude>
							<groupId>org.projectlombok</groupId>
							<artifactId>lombok</artifactId>
						</exclude>
					</excludes>
				</configuration>
			</plugin>
		</plugins>
	</build>

</project>

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\.mvn\wrapper\maven-wrapper.properties ================
wrapperVersion=3.3.4
distributionType=only-script
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.12/apache-maven-3.9.12-bin.zip

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\CustomerapiApplication.java ================
package com.ecom.customerapi;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class CustomerapiApplication {

	public static void main(String[] args) {
		SpringApplication.run(CustomerapiApplication.class, args);
	}

}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\config\MapperConfig.java ================
package com.ecom.customerapi.config;

import org.modelmapper.ModelMapper;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MapperConfig
{
    @Bean
    public ModelMapper getmapper()
    {
        return new ModelMapper();
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\controller\AddressController.java ================
package com.ecom.customerapi.controller;

import com.ecom.customerapi.dto.AddressDto;
import com.ecom.customerapi.dto.CustomerDto;
import com.ecom.customerapi.service.AddressService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api")
public class AddressController
{
    @Autowired
    private AddressService addressservice;

    @PostMapping("/add/address/{customerId}")
    public ResponseEntity<AddressDto> addNewCustomerAddress(@PathVariable Long customerId,@RequestBody AddressDto addressdto)
    {
        AddressDto addresssaved = addressservice.addNewAddress(addressdto , customerId);
        return new ResponseEntity<>(addresssaved , HttpStatus.CREATED);
    }

    @GetMapping("/getall/addresses")
    public ResponseEntity<List<AddressDto>> getAllAddress()
    {
        List<AddressDto> allAddresses = addressservice.getAllAddresses();
        return new ResponseEntity<>(allAddresses , HttpStatus.CREATED);
    }

    @GetMapping("/getall/addresses/{customerId}")
    public ResponseEntity<List<AddressDto>> getAllAddressofCustomerById(@PathVariable Long customerId)
    {
        List<AddressDto> allAddressesofcustomer = addressservice.getAllAddressofCustomerByIdServ(customerId);
        return new ResponseEntity<>(allAddressesofcustomer , HttpStatus.CREATED);
    }

    @DeleteMapping("/delete/address/{addressId}")
    public ResponseEntity<String> deleteCustomerAddress(@PathVariable Long addressId)
    {
        String message = addressservice.deleteCustomerAddressServ(addressId);
        return new ResponseEntity<>(message , HttpStatus.CREATED);
    }

    @PutMapping("/update/address/{addressId}")
    public ResponseEntity<AddressDto> updateCustomerAddress(@PathVariable Long addressId,@RequestBody AddressDto addressdto)
    {
        AddressDto updatedAddress = addressservice.updateAddress(addressdto , addressId);
        return new ResponseEntity<>(updatedAddress , HttpStatus.CREATED);
    }



}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\controller\CustomerController.java ================
package com.ecom.customerapi.controller;


import com.ecom.customerapi.dto.CustomerDto;
import com.ecom.customerapi.repository.CustomerRepository;
import com.ecom.customerapi.service.CustomerService;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@Slf4j
@RestController
@RequestMapping("/api/customer")
public class CustomerController
{

    @Autowired
    private CustomerService customerservice;

    @Autowired
    private CustomerRepository customerrepo;

    /**
     * Create a new customer
     */
    @PostMapping("/add/customer")
    //@PreAuthorize("hasAnyRole('SELLER','ADMIN','USER') and hasAuthority('USER_CREATE')")
    public ResponseEntity<CustomerDto> addNewCustomer(@RequestBody CustomerDto customerdto)
    {
        log.info("NATALIE control entered the addnewcustomer with the customerdto "+customerdto);
        System.out.println("========================================================================================================================================================================");
        CustomerDto customersaved = customerservice.addNewCustomerserv(customerdto);

        return new ResponseEntity<>(customersaved, HttpStatus.CREATED);
    }

    /**
     * Get all customers (ADMIN only)
     */
    @GetMapping("/getall/customers")
    @PreAuthorize("hasRole('ADMIN') and hasAuthority('USER_VIEW_ALL')")
    public ResponseEntity<List<CustomerDto>> getallCustomers()
    {

        List<CustomerDto> allcustomers = customerservice.getAllCustomers();

        return new ResponseEntity<>(allcustomers, HttpStatus.CREATED);
    }

    /**
     * Get logged-in customer details
     */
    @GetMapping("/get/logged/customerdetails")
    @PreAuthorize("hasAnyRole('ADMIN','USER') and hasAuthority('USER_VIEW')")
    public ResponseEntity<CustomerDto> getCustomerDetails()
    {

        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

        String userId = (String) authentication.getPrincipal();
        Long customerId = Long.valueOf(userId);

        CustomerDto onecustomer = customerservice.getCustomerByIdserv(customerId);

        return new ResponseEntity<>(onecustomer, HttpStatus.CREATED);
    }

    /**
     * Update customer (ADMIN only)
     */
    @PutMapping("/get/category/{customerId}")
    @PreAuthorize("hasRole('ADMIN') and hasAuthority('USER_UPDATE')")
    public ResponseEntity<CustomerDto> updateCustomer(@PathVariable Long customerId, @RequestBody CustomerDto customerdto) {
        CustomerDto onecustomer =
                customerservice.updateCustomerServ(customerId, customerdto);

        return new ResponseEntity<>(onecustomer, HttpStatus.CREATED);
    }

    /**
     * Delete customer (ADMIN only)
     */
    @DeleteMapping("/delete/category/{customerId}")
    @PreAuthorize("hasRole('ADMIN') and hasAuthority('USER_DELETE')")
    public ResponseEntity<String> deleteCustomer(@PathVariable Long customerId)
    {
        String message =
                customerservice.deleteCustomerServ(customerId);

        return new ResponseEntity<>(message, HttpStatus.CREATED);
    }

    /**
     * Get customer by ID (ADMIN only)
     */
    @GetMapping("/get/customer/{customerId}")
    @PreAuthorize("hasAnyRole('ADMIN') and hasAuthority('USER_VIEW')")
    public ResponseEntity<CustomerDto> getCustomerDetailsByIdByAdmin(@PathVariable Long customerId)
    {
        CustomerDto onecustomer = customerservice.getCustomerByIdserv(customerId);

        return new ResponseEntity<>(onecustomer, HttpStatus.CREATED);
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\dto\AddressDto.java ================
package com.ecom.customerapi.dto;

import com.ecom.customerapi.entity.CustomerEntity;
import lombok.Data;

@Data
public class AddressDto
{
    private Long addrId;
    private String hno;
    private String street;
    private String city;
    private String state;
    private String zipCode;
    private String addrType;
    private String deleteSw;

    //private CustomerEntity customer;
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\dto\CustomerDto.java ================
package com.ecom.customerapi.dto;

import com.ecom.customerapi.enums.Role;
import jakarta.persistence.Column;
import lombok.Data;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import java.time.LocalDate;
import java.util.Set;

@Data
public class CustomerDto
{
    private Long customerId;
    private String name;
    private String email;
    private String phoneNo;

    private Set<Role> roles;

    private LocalDate dateCreated;
    private LocalDate lastUpdated;
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\entity\AddressEntity.java ================
package com.ecom.customerapi.entity;

import jakarta.persistence.*;
import lombok.Getter;
import lombok.Setter;

@Entity
@Getter
@Setter
@Table(name = "customer_address")
public class AddressEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long addrId;
    private String hno;
    private String street;
    private String city;
    private String state;
    private String zipCode;
    private String addrType;
    private String deleteSw;

    @ManyToOne
    @JoinColumn(name = "customer_id")
    private CustomerEntity customer;
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\entity\CustomerEntity.java ================
package com.ecom.customerapi.entity;



import com.ecom.customerapi.enums.Role;

import com.ecom.customerapi.springsecurity.config.PermissionMapping;
import jakarta.persistence.*;
import lombok.Getter;
import lombok.Setter;
import lombok.ToString;
import org.hibernate.annotations.CreationTimestamp;
import org.hibernate.annotations.UpdateTimestamp;

import java.time.LocalDate;
import java.util.HashSet;
import java.util.Set;

@Entity
@Getter
@Setter
@ToString
@Table(name = "customer")
public class CustomerEntity {

    @Id
    private Long customerId;

    private String name;
    private String email;
    private String phoneNo;

    @ElementCollection(fetch = FetchType.EAGER)
    @Enumerated(EnumType.STRING)
    private Set<Role> roles;

    @CreationTimestamp
    @Column(name = "date_created", updatable = false)
    private LocalDate dateCreated;

    @UpdateTimestamp
    @Column(name = "last_updated", insertable = false)
    private LocalDate lastUpdated;

    public Set<String> getAuthorities() {
        Set<String> authorities = new HashSet<>();

        for (Role role : roles) {
            authorities.add("ROLE_" + role.name());
            authorities.addAll(PermissionMapping.getAuthoritiesForRole(role));
        }
        return authorities;
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\enums\Permission.java ================
package com.ecom.customerapi.enums;

public enum Permission
{
    /* ================= USER ================= */
    USER_VIEW, USER_CREATE, USER_UPDATE, USER_DELETE, USER_VIEW_ALL,

    /* ================= ADDRESS ================= */
    ADDRESS_VIEW, ADDRESS_CREATE, ADDRESS_UPDATE, ADDRESS_DELETE,

    /* ================= PRODUCT ================= */
    PRODUCT_VIEW, PRODUCT_CREATE,PRODUCT_UPDATE, PRODUCT_DELETE,

    /* ================= CATEGORY ================= */
    CATEGORY_VIEW, CATEGORY_CREATE, CATEGORY_UPDATE, CATEGORY_DELETE,

    /* ================= ORDER ================= */
    ORDER_VIEW, ORDER_CREATE, ORDER_UPDATE, ORDER_CANCEL, ORDER_VIEW_ALL,

    /* ================= CART ================= */
    CART_VIEW, CART_ADD_ITEM, CART_REMOVE_ITEM, CART_CLEAR, CART_VIEW_ALL,

    /* ================= PAYMENT ================= */
    PAYMENT_INITIATE, PAYMENT_VIEW,

    /* ================= INVENTORY ================= */
    INVENTORY_VIEW, INVENTORY_UPDATE
}


================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\enums\Role.java ================
package com.ecom.customerapi.enums;

public enum Role
{
    USER,
    SELLER,
    ADMIN,
    NORMAL
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\exception\CompileTimeException.java ================
package com.ecom.customerapi.exception;

public class CompileTimeException extends Exception
{
    CompileTimeException(String message)
    {
        super(message);
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\exception\GenericApiException.java ================
package com.ecom.customerapi.exception;

public class GenericApiException extends RuntimeException
{
    GenericApiException(String message)
    {
        super(message);
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\exception\GlobalExceptionHandler.java ================
package com.ecom.customerapi.exception;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

@RestControllerAdvice
public class GlobalExceptionHandler
{
    @ExceptionHandler(ResourceNotFoundException.class)
    public ResponseEntity<String> myResourceNotFoundException(ResourceNotFoundException e)
    {
        String message = e.getMessage();
        return new ResponseEntity<>(message , HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(GenericApiException.class)
    public ResponseEntity<String> myGenericApiException(GenericApiException e)
    {
        String message = e.getMessage();
        return new ResponseEntity<>(message , HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(CompileTimeException.class)
    public ResponseEntity<String> myCompileTimeException(CompileTimeException e)
    {
        String message = e.getMessage();
        return new ResponseEntity<>(message , HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public ResponseEntity<String> myValidationError(MethodArgumentNotValidException e)
    {
        String message = e.getMessage();
        return new ResponseEntity<>(message , HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<String> myException(Exception e)
    {
        String message = e.getMessage();
        return new ResponseEntity<>(message , HttpStatus.BAD_REQUEST);
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\exception\ResourceNotFoundException.java ================
package com.ecom.customerapi.exception;


public class ResourceNotFoundException extends RuntimeException
{
    String resourceName;
    String field;
    String fieldName;
    Integer fieldId;

    public ResourceNotFoundException() {
    }

    public ResourceNotFoundException(String resourceName, String field, String fieldName) {
        super(String.format("%s not found with %s: %s", resourceName, field, fieldName));
        this.resourceName = resourceName;
        this.field = field;
        this.fieldName = fieldName;
    }

    public ResourceNotFoundException(String resourceName, String field, Integer fieldId) {
        super(String.format("%s not found with %s: %d", resourceName, field, fieldId));
        this.resourceName = resourceName;
        this.field = field;
        this.fieldId = fieldId;
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\repository\AddressRepository.java ================
package com.ecom.customerapi.repository;

import com.ecom.customerapi.entity.AddressEntity;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface AddressRepository extends JpaRepository<AddressEntity , Long>
{
    List<AddressEntity> findByCustomer_CustomerId(Long customerId);
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\repository\CustomerRepository.java ================
package com.ecom.customerapi.repository;

import com.ecom.customerapi.entity.CustomerEntity;
import org.springframework.data.jpa.repository.JpaRepository;

public interface CustomerRepository extends JpaRepository<CustomerEntity , Long>
{
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\service\AddressService.java ================
package com.ecom.customerapi.service;

import com.ecom.customerapi.dto.AddressDto;

import java.util.List;

public interface AddressService
{
    public AddressDto addNewAddress(AddressDto addressdto, Long customerId);

    public List<AddressDto> getAllAddresses();

    public List<AddressDto> getAllAddressofCustomerByIdServ(Long customerId);

    public String deleteCustomerAddressServ(Long addressId);

    AddressDto updateAddress(AddressDto addressdto, Long addressId);
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\service\AddressServiceImpl.java ================
package com.ecom.customerapi.service;

import com.ecom.customerapi.dto.AddressDto;
import com.ecom.customerapi.entity.AddressEntity;
import com.ecom.customerapi.entity.CustomerEntity;
import com.ecom.customerapi.exception.ResourceNotFoundException;
import com.ecom.customerapi.repository.AddressRepository;
import com.ecom.customerapi.repository.CustomerRepository;
import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class AddressServiceImpl implements AddressService
{
    @Autowired
    private CustomerRepository customerrepo;

    @Autowired
    private ModelMapper modelmapper;

    @Autowired
    private AddressRepository addressrepo;

    @Override
    public AddressDto addNewAddress(AddressDto addressdto, Long customerId)
    {
        CustomerEntity customerentity = customerrepo.findById(customerId)
                .orElseThrow(()-> new ResourceNotFoundException("customer","customerId",""+customerId));

        AddressEntity addressentity = modelmapper.map(addressdto , AddressEntity.class);
        addressentity.setCustomer(customerentity);

        AddressEntity savedaddress = addressrepo.save(addressentity);
        return modelmapper.map(savedaddress , AddressDto.class);
    }

    @Override
    public List<AddressDto> getAllAddresses()
    {
        List<AddressEntity> alladdressentity = addressrepo.findAll();
        List<AddressDto> alladdressdtos = alladdressentity.stream()
                .map(individualaddressentity -> modelmapper.map(individualaddressentity , AddressDto.class))
                .toList();

        return alladdressdtos;
    }

    @Override
    public List<AddressDto> getAllAddressofCustomerByIdServ(Long customerId)
    {
        CustomerEntity customerentity = customerrepo.findById(customerId)
                .orElseThrow(()-> new ResourceNotFoundException("customer","customerId",""+customerId));

        List<AddressEntity> alladdressentityofCustomer = addressrepo.findByCustomer_CustomerId(customerId);
        List<AddressDto> alladdressdtosofCustomer = alladdressentityofCustomer.stream()
                .map(individualaddressentity -> modelmapper.map(individualaddressentity , AddressDto.class))
                .toList();

        return alladdressdtosofCustomer;
    }

    @Override
    public String deleteCustomerAddressServ(Long addressId)
    {
        AddressEntity addressentity = addressrepo.findById(addressId)
                .orElseThrow(()-> new ResourceNotFoundException("address","addressId",""+addressId));

        addressrepo.deleteById(addressId);
        return "success";
    }

    @Override
    public AddressDto updateAddress(AddressDto addressdto, Long addressId)
    {
        AddressEntity addressentity = addressrepo.findById(addressId)
                .orElseThrow(()-> new ResourceNotFoundException("address","addressId",""+addressId));

        addressentity.setHno(addressdto.getHno());
        addressentity.setCity(addressdto.getCity());
        addressentity.setState(addressdto.getState());
        addressentity.setStreet(addressdto.getStreet());
        addressentity.setAddrType(addressdto.getAddrType());
        addressentity.setDeleteSw(addressdto.getDeleteSw());
        addressentity.setZipCode(addressdto.getZipCode());

        AddressEntity savedaddress = addressrepo.save(addressentity);

        return modelmapper.map(savedaddress , AddressDto.class);
    }


}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\service\CustomerService.java ================
package com.ecom.customerapi.service;

import com.ecom.customerapi.dto.CustomerDto;

import java.util.List;

public interface CustomerService {
    CustomerDto addNewCustomerserv(CustomerDto customerdto);

    List<CustomerDto> getAllCustomers();

    CustomerDto getCustomerByIdserv(Long customerId);

    CustomerDto updateCustomerServ(Long customerId ,CustomerDto customerdto);

    String deleteCustomerServ(Long customerId);
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\service\CustomerServiceImpl.java ================
package com.ecom.customerapi.service;

import com.ecom.customerapi.dto.CustomerDto;
import com.ecom.customerapi.entity.CustomerEntity;
import com.ecom.customerapi.exception.ResourceNotFoundException;
import com.ecom.customerapi.repository.CustomerRepository;
import lombok.extern.slf4j.Slf4j;
import org.modelmapper.ModelMapper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Slf4j
@Service
public class CustomerServiceImpl implements CustomerService
{

    @Autowired
    private ModelMapper modelmapper;

    @Autowired
    private CustomerRepository customerrepo;

    @Override
    public CustomerDto addNewCustomerserv(CustomerDto customerdto)
    {
        log.info("NATALIE control entered addNewCustomerserv");
        /*
            1.check if the customer is present previously or not using customer name
            2.if not there create a new account
         */

        CustomerEntity customerentity = modelmapper.map(customerdto , CustomerEntity.class);
        log.info("converting the customerdto to the customerentity = "+customerentity);

        CustomerEntity savedcustomer = customerrepo.save(customerentity);
        log.info("saved customerentity is ="+savedcustomer);

        return modelmapper.map(savedcustomer , CustomerDto.class);
    }

    @Override
    public List<CustomerDto> getAllCustomers()
    {
        List<CustomerEntity> allcutomerentities = customerrepo.findAll();

        List<CustomerDto> allcutomerdtos = allcutomerentities.stream()
                .map(individualcustomerentiy -> modelmapper.map(individualcustomerentiy , CustomerDto.class))
                .toList();

        return allcutomerdtos;
    }

    @Override
    public CustomerDto getCustomerByIdserv(Long customerId)
    {
        /*
            1.check if the customer is present with the id or not
         */

        CustomerEntity customerentity = customerrepo.findById(customerId)
                .orElseThrow(()-> new ResourceNotFoundException("customer","customerId",""+customerId));

        return modelmapper.map(customerentity , CustomerDto.class);
    }

    @Override
    public CustomerDto updateCustomerServ(Long customerId,CustomerDto customerdto)
    {
        CustomerEntity customerentity = customerrepo.findById(customerId)
                .orElseThrow(()-> new ResourceNotFoundException("customer","customerId",""+customerdto.getCustomerId()));

        customerentity.setName(customerdto.getName());
        customerentity.setEmail(customerdto.getEmail());
        customerentity.setPhoneNo(customerdto.getPhoneNo());
        customerentity.setLastUpdated(customerdto.getLastUpdated());


        CustomerEntity updatedcustomer = customerrepo.save(customerentity);

        return modelmapper.map(updatedcustomer , CustomerDto.class);
    }

    @Override
    public String deleteCustomerServ(Long customerId)
    {
        CustomerEntity customerentity = customerrepo.findById(customerId)
                .orElseThrow(()-> new ResourceNotFoundException("customer","customerId",""+customerId));

        customerrepo.deleteById(customerId);
        return "success";
    }


}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\springsecurity\config\PermissionMapping.java ================
package com.ecom.customerapi.springsecurity.config;



import com.ecom.customerapi.enums.Permission;
import com.ecom.customerapi.enums.Role;
import lombok.extern.slf4j.Slf4j;


import java.util.Map;
import java.util.Set;
import java.util.stream.Collectors;

import static com.ecom.customerapi.enums.Permission.*;
import static com.ecom.customerapi.enums.Role.*;


@Slf4j
public class PermissionMapping
{
    /*private static final Map<Role, Set<Permission>> map = Map.of(
            USER, Set.of(USER_VIEW, POST_VIEW),
            SELLER, Set.of(POST_CREATE, USER_UPDATE, POST_UPDATE),
            ADMIN, Set.of(POST_CREATE, USER_UPDATE, POST_UPDATE, USER_DELETE, USER_CREATE, POST_DELETE)
    );*/

    private static final Map<Role, Set<Permission>> map = Map.of(

            /* ================= CUSTOMER ================= */
            USER, Set.of(
                    USER_VIEW, USER_UPDATE,
                    ADDRESS_VIEW, ADDRESS_CREATE, ADDRESS_UPDATE, ADDRESS_DELETE,
                    PRODUCT_VIEW, CATEGORY_VIEW,
                    CART_VIEW, CART_ADD_ITEM, CART_REMOVE_ITEM, CART_CLEAR,
                    ORDER_CREATE, ORDER_VIEW, ORDER_CANCEL,
                    PAYMENT_INITIATE, PAYMENT_VIEW
            ),

            /* ================= SELLER ================= */
            SELLER, Set.of(
                    USER_VIEW, USER_UPDATE,
                    ADDRESS_VIEW, ADDRESS_CREATE, ADDRESS_UPDATE, ADDRESS_DELETE,
                    PRODUCT_VIEW, PRODUCT_CREATE, PRODUCT_UPDATE,
                    CATEGORY_VIEW,
                    INVENTORY_VIEW, INVENTORY_UPDATE,
                    ORDER_VIEW
            ),

            /* ================= ADMIN ================= */
            ADMIN, Set.of(
                    USER_VIEW, USER_VIEW_ALL, USER_CREATE, USER_UPDATE, USER_DELETE,
                    ADDRESS_VIEW, ADDRESS_CREATE, ADDRESS_UPDATE, ADDRESS_DELETE,
                    PRODUCT_VIEW, PRODUCT_CREATE, PRODUCT_UPDATE, PRODUCT_DELETE,
                    CATEGORY_VIEW, CATEGORY_CREATE, CATEGORY_UPDATE, CATEGORY_DELETE,
                    CART_VIEW, CART_VIEW_ALL, ORDER_VIEW,
                    ORDER_UPDATE, ORDER_VIEW_ALL, ORDER_CANCEL,
                    INVENTORY_VIEW, INVENTORY_UPDATE,
                    PAYMENT_VIEW

            )
    );

    public static Set<String> getAuthoritiesForRole(Role role)
    {
        log.info("PermissionMapping â†’ resolving permissions for role {}", role);

         Set<String> authorities  =  map.getOrDefault(role, Set.of())
                                        .stream()
                                        .map(Permission::name)
                                        .collect(Collectors.toSet());
        return authorities;
    }

  /*  public static Set<String> getAuthoritiesForRole(Role role)
    {

        Set<String> allpermissions = map.get(role).stream()
                .map(permission -> permission))
                .collect(Collectors.toSet());

        return allpermissions;
    }

    public static Set<String> getAuthoritiesForRole(Role roles)
    {


        Set<String> authorities = new HashSet<>();

        for (Role role : roles) {
            // ROLE authority
            authorities.add("ROLE_" + role.name());

            // Permission authorities
            ROLE_PERMISSION_MAP
                    .getOrDefault(role, Set.of())
                    .forEach(p -> authorities.add(p.name()));
        }

        return authorities;
    }
*/

}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\springsecurity\config\SecurityConfig.java ================
package com.ecom.customerapi.springsecurity.config;



import com.ecom.customerapi.springsecurity.filter.GatewayAuthenticationFilter;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@Slf4j
@EnableMethodSecurity(prePostEnabled = true)
@Configuration
public class SecurityConfig
{
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http, GatewayAuthenticationFilter gatewayAuthenticationFilter) throws Exception
    {
        log.info("NATALIE control entered securityFilterChain ");
            http.csrf(csrf -> csrf.disable())
                .sessionManagement(sm ->
                                           sm.sessionCreationPolicy(SessionCreationPolicy.STATELESS) )
                .authorizeHttpRequests(auth -> auth.anyRequest().authenticated())
                .addFilterBefore(gatewayAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

            return http.build();
    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\java\com\ecom\customerapi\springsecurity\filter\GatewayAuthenticationFilter.java ================
package com.ecom.customerapi.springsecurity.filter;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

@Slf4j
@Component
public class GatewayAuthenticationFilter extends OncePerRequestFilter
{
    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException
    {
        log.info("NATALIE control entered doFilterInternal");

        String userId = request.getHeader("X-User-Id");
        log.info("NATALIE control entered doFilterInternal");

        String authoritiesHeader = request.getHeader("X-User-Authorities");
        log.info("NATALIE control entered doFilterInternal");

        if (userId != null && authoritiesHeader != null)
        {
            /*
            List<SimpleGrantedAuthority> authorities =
                    Arrays.stream(authoritiesHeader.split(","))
                            .map(String::trim)
                            .map(SimpleGrantedAuthority::new)
                            .toList();
             */
            List<SimpleGrantedAuthority> authorities = new ArrayList<>();

            String[] authorityArray = authoritiesHeader.split(",");

            for (String authority : authorityArray) {
                String cleaned = authority.trim();
                SimpleGrantedAuthority grantedAuthority =
                        new SimpleGrantedAuthority(cleaned);

                authorities.add(grantedAuthority);
            }


            log.info("NATALIE List<SimpleGrantedAuthority> authorities = "+authorities);

            UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userId, null, authorities);
            log.info("NATALIE authentication object created is = "+authentication);

            SecurityContextHolder.getContext().setAuthentication(authentication);
            log.info("NATALIE execution of doFilterInternal is completed and authentiction object in the securitycontextholder is ="+SecurityContextHolder.getContext().getAuthentication());

        }
        filterChain.doFilter(request, response);

    }
}

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\main\resources\application.properties ================
spring.application.name=customerapi


spring.datasource.url=jdbc:mysql://host.docker.internal:3306/timesecurity
spring.datasource.username=root
spring.datasource.password=Nvr144@144
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=create
spring.jpa.show-sql=true

server.port=7003

================ FILE: C:\Users\varshith reddy\Desktop\projects\customerapi\src\test\java\com\ecom\customerapi\CustomerapiApplicationTests.java ================
package com.ecom.customerapi;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class CustomerapiApplicationTests {

	@Test
	void contextLoads() {
	}

}

